pipeline {
    agent any

    tools {
        jdk 'jdk21'
    }

    environment {
        PROJECT_ID = 'jp-project-11'
        CREDENTIALS_ID = 'gcp-service-account'
        APP_YAML = 'app.yaml'

        PYTHON_PATH = 'C:\\Users\\jpatnala\\AppData\\Local\\Microsoft\\WindowsApps\\python.exe'
        PATH = "C:\\Users\\jpatnala\\AppData\\Local\\Google\\Cloud SDK\\google-cloud-sdk\\bin;C:\\Users\\jpatnala\\AppData\\Local\\Programs\\Python\\Python313\\Scripts;C:\\Path\\To\\Python;${env.PATH}"

  
    }

    stages {
        stage('Checkout') {
            steps {
                git branch: 'main',
                    url: 'https://github.com/jayaramprasadp/springboot-hello.git'
            }
        }

        stage('Build with Maven') {
            steps {
                sh 'mvn clean package -DskipTests'
            }
        }

        stage('Authenticate GCP') {
            steps {
                withCredentials([file(credentialsId: "${CREDENTIALS_ID}", variable: 'GCP_KEY')]) {
                    sh '''
                        gcloud auth activate-service-account --key-file=$GCP_KEY
                        gcloud config set project ${PROJECT_ID}
                    '''
                }
            }
        }

        stage('Deploy to App Engine') {
            steps {
                sh '''
                    gcloud app deploy ${APP_YAML} --quiet
                '''
            }
        }
    }
}




